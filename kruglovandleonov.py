import random

class БазовыйПерсонаж:
    def __init__(self, имя, здоровье):
        self.имя = имя
        self.здоровье = здоровье
    
    def атаковать(self, цель):
        pass  
    
    def жив(self):
        return self.здоровье > 0

class Игрок(БазовыйПерсонаж):
    def __init__(self, имя):
        super().__init__(имя, 100)
        self.инвентарь = []
        self.текущая_локация = None
    
    def показать_информацию(self):
        print(f"\n=== {self.имя} ===")
        print(f"Здоровье: {self.здоровье}")
        if self.инвентарь:
            print(f"Инвентарь: {', '.join(self.инвентарь)}")
        else:
            print("Инвентарь: пусто")
        
        if self.текущая_локация:
            print(f"Локация: {self.текущая_локация.название}")

class Гоблин(БазовыйПерсонаж):
    def __init__(self):
        super().__init__("Гоблин", 30)
    
    def атаковать(self, цель):
        урон = random.randint(5, 15) 
        цель.здоровье -= урон
        print(f"Гоблин бросается на вас и наносит {урон} урона!")
        return урон

class Орк(БазовыйПерсонаж):
    def __init__(self):
        super().__init__("Орк", 50)
    
    def атаковать(self, цель):
        урон = 12 
        цель.здоровье -= урон
        print(f"Орк замахивается дубиной и наносит {урон} урона!")
        return урон

class Босс(БазовыйПерсонаж):
    def __init__(self):
        super().__init__("Дракон", 80)
    
    def атаковать(self, цель):
        урон = random.randint(10, 20)
        цель.здоровье -= урон
        print(f"Дракон извергает пламя и наносит {урон} урона!")
        return урон

class Локация:
    def __init__(self, название, описание):
        self.название = название
        self.описание = описание
        self.враги = []
        self.предметы = []
        self.проходы = {} 
    
    def добавить_проход(self, направление, локация):
        self.проходы[направление] = локация
    
    def показать_информацию(self):
        print(f"\n=== {self.название} ===")
        print(self.описание)
        
        if self.враги:
            имена_врагов = [враг.имя for враг in self.враги]
            print(f"Здесь находятся: {', '.join(имена_врагов)}")
        
        if self.предметы:
            print(f"На полу лежит: {', '.join(self.предметы)}")
        
        if self.проходы:
            направления = list(self.проходы.keys())
            print(f"Отсюда можно пойти: {', '.join(направления)}")

def обработать_переход(игрок, направление):
    if направление in игрок.текущая_локация.проходы:
        игрок.текущая_локация = игрок.текущая_локация.проходы[направление]
        print(f"\nВы перешли в {игрок.текущая_локация.название}")
        игрок.текущая_локация.показать_информацию()
    else:
        print("\nНельзя пойти в этом направлении!")

def обработать_взять(игрок, предмет):
    if предмет in игрок.текущая_локация.предметы:
        игрок.инвентарь.append(предмет)
        игрок.текущая_локация.предметы.remove(предмет)
        print(f"\nВы подобрали {предмет}!")
    else:
        print("\nТакого предмета здесь нет!")

def обработать_бой(игрок):
    if not игрок.текущая_локация.враги:
        print("\nЗдесь нет врагов!")
        return True
    

    for враг in игрок.текущая_локация.враги[:]:
        print(f"\nВы встретили {враг.имя}! Начинается бой!")
        
        while враг.жив() and игрок.жив():
            действие = input("Что будете делать? (атаковать/бежать): ").lower()
            
            if действие == "атаковать":
                if "меч дракона" in игрок.инвентарь and враг.имя == "Дракон":
                    урон_игрока = random.randint(25, 35)  
                    print("Меч дракона светится! Он особенно эффективен против дракона!")
                else:
                    урон_игрока = random.randint(15, 25)
                
                враг.здоровье -= урон_игрока
                print(f"\nВы нанесли {враг.имя} {урон_игрока} урона!")
                
                if враг.здоровье <= 0:
                    print(f"\nВы победили {враг.имя}!")
                    игрок.текущая_локация.враги.remove(враг)
                    break
                
                враг.атаковать(игрок)
                print(f"Ваше здоровье: {игрок.здоровье}")
                
                if not игрок.жив():
                    print("\nВы погибли в бою!")
                    return False
            
            elif действие == "бежать":
                print("\nВы сбежали от врага!")
                break
            
            else:
                print("\nНеизвестная команда! Используйте 'атаковать' или 'бежать'")
    
    return True

def обработать_информацию(игрок):
    игрок.показать_информацию()
    игрок.текущая_локация.показать_информацию()

def обработать_использовать(игрок, предмет):
    if предмет in игрок.инвентарь:
        if предмет == "зелье здоровья":
            игрок.здоровье = min(100, игрок.здоровье + 30)
            игрок.инвентарь.remove(предмет)
            print("\nВы выпили зелье здоровья! Восстановлено 30 здоровья")
        elif предмет == "ключ" and игрок.текущая_локация.название == "Замок":
            print("\nКлюч подошел к старой двери, но она и так была открыта...")
        else:
            print(f"\nВы использовали {предмет}")
    else:
        print("\nУ вас нет этого предмета!")

def главная():
    print("=== ТЕКСТОВЫЙ КВЕСТ: ПОИСК ДРАКОНА ===")
    имя_игрока = input("Введите имя вашего персонажа: ")
    игрок = Игрок(имя_игрока)
    
    лес = Локация("Лес", "Густой тёмный лес. В воздухе витает опасность.")
    пещера = Локация("Пещера", "Сырая и тёмная пещера. Слышно эхо капель воды.")
    замок = Локация("Замок", "Заброшенный замок. Ветер гуляет по пустым коридорам.")
    логово_дракона = Локация("Логово дракона", "Горячая пещера, наполненная золотом и костями.")
    
    лес.предметы = ["зелье"]
    лес.враги = [Гоблин()]
    
    пещера.предметы = ["ключ"]
    пещера.враги = [Гоблин(), Орк()]
    
    замок.предметы = ["меч"]
    замок.враги = [Орк()]
    
    логово_дракона.враги = [Босс()]
    
    лес.добавить_проход("север", пещера)
    пещера.добавить_проход("юг", лес)
    пещера.добавить_проход("восток", замок)
    замок.добавить_проход("запад", пещера)
    замок.добавить_проход("север", логово_дракона)
    логово_дракона.добавить_проход("юг", замок)
    
    игрок.текущая_локация = лес
    
    print(f"\nДобро пожаловать, {имя_игрока}!")
    print("Ваша цель: найти меч дракона и победить дракона в его логове.")
    print("\nДоступные команды:")
    print("  иди [направление] - перемещение (север, юг, восток, запад)")
    print("  взять [предмет] - подобрать предмет")
    print("  сражаться - начать бой с врагами")
    print("  информация - показать информацию")
    print("  использовать [предмет] - использовать предмет из инвентаря")
    print("  выход - выйти из игры")
    
    игрок.текущая_локация.показать_информацию()
    
    игра_активна = True
    
    while игра_активна and игрок.жив():
        команда = input("\nВведите команду: ").lower().split()
        
        if not команда:
            continue
        
        if команда[0] == "выход":
            print("\nСпасибо за игру!")
            break
        
        elif команда[0] == "иди" and len(команда) > 1:
            обработать_переход(игрок, команда[1])
            
            if (игрок.текущая_локация == логово_дракона and 
                "меч дракона" in игрок.инвентарь and 
                not логово_дракона.враги):
                print("\n" + "="*40)
                print("=== ПОБЕДА! ===")
                print("Вы победили дракона и спасли королевство!")
                print("="*40)
                break
        
        elif команда[0] == "взять" and len(команда) > 1:
            обработать_взять(игрок, команда[1])
        
        elif команда[0] == "сражаться":
            if not обработать_бой(игрок):
                игра_активна = False
        
        elif команда[0] == "информация":
            обработать_информацию(игрок)
        
        elif команда[0] == "использовать" and len(команда) > 1:
            обработать_использовать(игрок, команда[1])
        
        else:
            print("\nНеизвестная команда!")
            print("Доступные команды: иди, взять, сражаться, информация, использовать, выход")
    
    if not игрок.жив():
        print("\n" + "="*40)
        print("=== ИГРА ОКОНЧЕНА ===")
        print("Вы проиграли. Попробуйте снова!")
        print("="*40)

if __name__ == "__main__":
    главная()